<!-- filepath: d:\RSR_AVIATION\views\data.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>All Collections Data</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    .table-responsive { margin-bottom: 40px; }
    th, td { font-size: 0.97rem; }
    h2 { margin-top: 40px; }
    pre { margin: 0; font-size: 0.95em; }
  </style>
</head>
<body class="bg-light">
  <div class="container my-5">
    <div id="all-data">
    <h1 class="mb-5 text-center">All Collections Data</h1>

    <% if (typeof employees !== 'undefined' && employees.length) { %>
      <h2>Employees</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark">
            <tr>
              <% Object.keys(employees[0]._doc || employees[0]).forEach(key => { %>
                <th><%= key %></th>
              <% }) %>
            </tr>
          </thead>
          <tbody>
            <% employees.forEach(emp => { %>
              <tr>
                <% Object.values(emp._doc || emp).forEach(val => { %>
                  <td>
                    <% if (val instanceof Date) { %>
                      <%= val.toLocaleDateString() %>
                    <% } else if (typeof val === 'object' && val !== null) { %>
                      <pre><%= JSON.stringify(val, null, 2) %></pre>
                    <% } else { %>
                      <%= val %>
                    <% } %>
                  </td>
                <% }) %>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>

    <% if (typeof attendance !== 'undefined' && attendance.length) { %>
      <h2>Attendance</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark">
            <tr>
              <% Object.keys(attendance[0]._doc || attendance[0]).forEach(key => { %>
                <th><%= key %></th>
              <% }) %>
            </tr>
          </thead>
          <tbody>
            <% attendance.forEach(a => { %>
              <tr>
                <% Object.values(a._doc || a).forEach(val => { %>
                  <td>
                    <% if (val instanceof Date) { %>
                      <%= val.toLocaleDateString() %>
                    <% } else if (typeof val === 'object' && val !== null) { %>
                      <pre><%= JSON.stringify(val, null, 2) %></pre>
                    <% } else { %>
                      <%= val %>
                    <% } %>
                  </td>
                <% }) %>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>

    <% if (typeof announcements !== 'undefined' && announcements.length) { %>
      <h2>Announcements</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark">
            <tr>
              <% Object.keys(announcements[0]._doc || announcements[0]).forEach(key => { %>
                <th><%= key %></th>
              <% }) %>
            </tr>
          </thead>
          <tbody>
            <% announcements.forEach(a => { %>
              <tr>
                <% Object.values(a._doc || a).forEach(val => { %>
                  <td>
                    <% if (val instanceof Date) { %>
                      <%= val.toLocaleDateString() %>
                    <% } else if (typeof val === 'object' && val !== null) { %>
                      <pre><%= JSON.stringify(val, null, 2) %></pre>
                    <% } else { %>
                      <%= val %>
                    <% } %>
                  </td>
                <% }) %>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>

    <% if (typeof notifications !== 'undefined' && notifications.length) { %>
      <h2>Notifications</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark">
            <tr>
              <% Object.keys(notifications[0]._doc || notifications[0]).forEach(key => { %>
                <th><%= key %></th>
              <% }) %>
            </tr>
          </thead>
          <tbody>
            <% notifications.forEach(n => { %>
              <tr>
                <% Object.values(n._doc || n).forEach(val => { %>
                  <td>
                    <% if (val instanceof Date) { %>
                      <%= val.toLocaleDateString() %>
                    <% } else if (typeof val === 'object' && val !== null) { %>
                      <pre><%= JSON.stringify(val, null, 2) %></pre>
                    <% } else { %>
                      <%= val %>
                    <% } %>
                  </td>
                <% }) %>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>

    <% if (typeof leaves !== 'undefined' && leaves.length) { %>
      <h2>Leaves</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark">
            <tr>
              <% Object.keys(leaves[0]._doc || leaves[0]).forEach(key => { %>
                <th><%= key %></th>
              <% }) %>
            </tr>
          </thead>
          <tbody>
            <% leaves.forEach(l => { %>
              <tr>
                <% Object.values(l._doc || l).forEach(val => { %>
                  <td>
                    <% if (val instanceof Date) { %>
                      <%= val.toLocaleDateString() %>
                    <% } else if (typeof val === 'object' && val !== null) { %>
                      <pre><%= JSON.stringify(val, null, 2) %></pre>
                    <% } else { %>
                      <%= val %>
                    <% } %>
                  </td>
                <% }) %>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>

    <% if (typeof regularizations !== 'undefined' && regularizations.length) { %>
      <h2>Regularizations</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle bg-white">
          <thead class="table-dark">
            <tr>
              <% Object.keys(regularizations[0]._doc || regularizations[0]).forEach(key => { %>
                <th><%= key %></th>
              <% }) %>
            </tr>
          </thead>
          <tbody>
            <% regularizations.forEach(r => { %>
              <tr>
                <% Object.values(r._doc || r).forEach(val => { %>
                  <td>
                    <% if (val instanceof Date) { %>
                      <%= val.toLocaleDateString() %>
                    <% } else if (typeof val === 'object' && val !== null) { %>
                      <pre><%= JSON.stringify(val, null, 2) %></pre>
                    <% } else { %>
                      <%= val %>
                    <% } %>
                  </td>
                <% }) %>
              </tr>
            <% }) %>
          </tbody>
        </table>
        </div>

      </div>

    <% } %>

    <!-- Add more collections here if you add more models -->
<div class="mb-4 text-end">
  <button class="btn btn-success me-2" onclick="exportTablesToExcel('all-data')">
    <i class="fa-solid fa-file-excel me-1"></i> Export to Excel
  </button>
  <button class="btn btn-primary" onclick="exportTablesToWord('all-data')">
    <i class="fa-solid fa-file-word me-1"></i> Export to Word
  </button>
</div>
  </div>
</body>
<!-- Font Awesome for icons (optional, if not already included) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script>
function exportTablesToExcel(containerId) {
  var dataType = 'application/vnd.ms-excel';
  var tableHTML = document.getElementById(containerId).outerHTML.replace(/ /g, '%20');
  var filename = 'all_data.xls';
  var downloadLink = document.createElement("a");
  document.body.appendChild(downloadLink);
  if(navigator.msSaveOrOpenBlob){
    var blob = new Blob(['\ufeff', tableHTML], { type: dataType });
    navigator.msSaveOrOpenBlob( blob, filename);
  } else {
    downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    downloadLink.download = filename;
    downloadLink.click();
  }
  document.body.removeChild(downloadLink);
}

function exportTablesToWord(containerId) {
  var header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' " +
               "xmlns:w='urn:schemas-microsoft-com:office:word' " +
               "xmlns='http://www.w3.org/TR/REC-html40'>" +
               "<head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";
  var footer = "</body></html>";
  var html = header + document.getElementById(containerId).outerHTML + footer;
  var blob = new Blob(['\ufeff', html], {
    type: 'application/msword'
  });
  var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
  var filename = 'all_data.doc';
  var downloadLink = document.createElement("a");
  document.body.appendChild(downloadLink);
  if(navigator.msSaveOrOpenBlob){
    navigator.msSaveOrOpenBlob(blob, filename);
  } else {
    downloadLink.href = url;
    downloadLink.download = filename;
    downloadLink.click();
  }
  document.body.removeChild(downloadLink);
}
</script>
</html>