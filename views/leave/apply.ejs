<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Leave Application | RSR Aviation</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

  <style>
    body {
      background: #eef1f6;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    .letter-container {
      max-width: 850px;
      margin: 40px auto;
      background: #fff;
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
    }

    .company-header {
      text-align: center;
      border-bottom: 2px solid #0d6efd;
      padding-bottom: 15px;
      margin-bottom: 30px;
    }

    .content {
      font-size: 16px;
      line-height: 1.8;
      margin-top: 25px;
    }

    .form-inline {
      display: inline-block;
      width: auto;
      border: none;
      border-bottom: 1px solid #333;
      border-radius: 0;
      padding: 2px 6px;
      font-size: 15px;
    }

    .form-inline:focus {
      box-shadow: none;
      border-color: #0d6efd;
    }

    .actions {
      text-align: center;
      margin-top: 40px;
    }
  </style>
</head>

<body>
  <%- include('../partials/anti-cache') %>

    <div class="letter-container" id="leaveLetter">

      <% if (typeof error !=='undefined' && error) { %>
        <div class="alert alert-danger mb-4">
          <i class="fa-solid fa-triangle-exclamation me-2"></i>
          <%= error %>
        </div>
        <% } %>

          <!-- ================= HEADER ================= -->
          <div class="company-header">
            <h3 class="fw-semibold">RSR Aviation</h3>
            <small class="text-muted">Human Resource Management System</small>
          </div>
          <!-- ================= TOP ACTION BAR ================= -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
              <h6 class="mb-0 fw-semibold">
                <i class="fa-solid fa-file-lines me-2 text-primary"></i>
                Leave Application Letter
              </h6>
              <small class="text-muted">Official HR Document</small>
            </div>

            <div>
              <button type="button" class="btn btn-outline-primary btn-sm" onclick="downloadWord()">
                <i class="fa-solid fa-file-word me-1"></i>
                Download Word
              </button>
            </div>
          </div>

          <hr>


          <!-- ================= FORM START ================= -->
          <form method="POST" action="/leave/apply">

            <div class="content">
              <p>
                To,<br>
                <strong>The HR Manager</strong><br>
                RSR Aviation
              </p>

              <p class="mt-3">
                <strong>Subject:</strong> Request for
                <select name="leaveType" class="form-inline" required>
                  <option value="">Select Leave</option>
                  <option>Casual</option>
                  <option>Sick</option>
                  <option>Earned</option>
                  <option>LOP</option>
                </select>
                Leave
              </p>

              <p class="mt-3">
                I would like to request leave from
                <input type="date" name="fromDate" class="form-inline" required>
                to
                <input type="date" name="toDate" class="form-inline" required>.
              </p>

              <p>
                The reason for my leave is as follows:
              </p>

              <p>
                <textarea name="reason" class="form-control" rows="3" placeholder="Enter reason for leave"
                  required></textarea>
              </p>

              <p>
                I kindly request you to consider my application and grant approval.
              </p>

              <p>
                Thanking you.
              </p>

              <p class="mt-5">
                Yours sincerely,<br><br>

                <strong>
                  <%= employee.firstName %>
                </strong><br>
                Employee ID: <%= employee.employeeCode %><br>
                  Department: <%= employee.department %>
              </p>

            </div>

            <!-- ================= ACTIONS ================= -->
            <div class="actions">
              <button type="submit" class="btn btn-primary px-4">
                <i class="fa-solid fa-paper-plane me-1"></i>
                Submit Leave
              </button>
            </div>

          </form>

    </div>
    <script>
      function downloadWord() {
        const content = document.getElementById("leaveLetter").innerHTML;

        const header = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office'
          xmlns:w='urn:schemas-microsoft-com:office:word'
          xmlns='http://www.w3.org/TR/REC-html40'>
    <head>
      <meta charset='utf-8'>
      <title>Leave Application</title>
      <style>
        body { font-family: Segoe UI, Arial, sans-serif; }
      </style>
    </head>
    <body>
  `;

        const footer = "</body></html>";

        const sourceHTML = header + content + footer;

        const source =
          "data:application/vnd.ms-word;charset=utf-8," +
          encodeURIComponent(sourceHTML);

        const link = document.createElement("a");
        document.body.appendChild(link);

        link.href = source;
        link.download = "Leave_Application_<%= employee.employeeCode %>.doc";
        link.click();

        document.body.removeChild(link);
      }
    </script>

</body>

</html>